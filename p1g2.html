<!DOCTYPE html>
<html>
<head>
    <title>Guitar Tuner</title>
    <script src="https://cdn.jsdelivr.net/npm/tone@14"></script>
</head>
<body>
    <h1>G2uner</h1>

    <div id="tuner">
        <button id="start-btn">Start Tuning</button>
        <div id="tuner-display">Tune your guitar here.</div>
    </div>

    <script>
        let audioContext = null;
        let analyser = null;

        document.getElementById('start-btn').addEventListener('click', () => {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
                    const microphone = audioContext.createMediaStreamSource(stream);
                    microphone.connect(analyser);
                }).catch((error) => {
                    console.error('Error accessing the microphone:', error);
                });
            }

            const pitch = new Tone.PitchShift().toDestination();

            analyser.fftSize = 2048;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            function updatePitch() {
                analyser.getByteTimeDomainData(dataArray);
                const pitchValue = pitch.getPitch(audioContext.sampleRate, dataArray);

                if (pitchValue) {
                    document.getElementById('tuner-display').textContent = `Detected pitch: ${pitchValue.toFixed(2)} Hz`;
                } else {
                    document.getElementById('tuner-display').textContent = 'No pitch detected.';
                }

                requestAnimationFrame(updatePitch);
            }

            updatePitch();
        });
    </script>
</body>
</html>
