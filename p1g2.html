<!DOCTYPE html>
<html>
<head>
    <title>Guitar Tuner</title>
</head>
<body>
    <h1>Guitar Tuner5</h1>
    <p>Click the "Start Tuner" button to allow microphone access and start tuning.</p>
    
    <button id="startTuner">Start Tuner</button>
    <div id="tunerDisplay">Waiting for input...</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tuna/0.4.3/tuna.min.js"></script>
    <script>
        let audioContext;
        let micStream;
        let tunerNode;
        
        document.getElementById("startTuner").addEventListener("click", () => {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                tunerNode = new Tuna(audioContext);
            }

            if (!micStream) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then((stream) => {
                        micStream = stream;
                        let source = audioContext.createMediaStreamSource(stream);
                        tunerNode.input = source;

                        tunerNode.init();
                        tunerNode.enable();
                        document.getElementById("tunerDisplay").textContent = "Tuning...";
                        
                        tunerNode.onNoteDetected = (note) => {
                            document.getElementById("tunerDisplay").textContent = `Detected Note: ${note}`;
                        };
                    })
                    .catch((error) => {
                        console.error("Error accessing microphone:", error);
                    });
            }
        });

        window.addEventListener("beforeunload", () => {
            if (micStream) {
                micStream.getTracks().forEach((track) => track.stop());
            }
        });
    </script>
</body>
</html>
