<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to 3D Scene</title>
    <script defer src="https://cdn.babylonjs.com/babylon.js"></script>
</head>
<body>

<img id="boxImage" src="path/to/box.png" alt="Box Image" style="display: none;">

<canvas id="renderCanvas"></canvas>

<script>
    // Load the image
    var image = document.getElementById('boxImage');

    // Create a canvas and draw the image on it
    var canvas = document.createElement('canvas');
    var context = canvas.getContext('2d');

    // Ensure the image is loaded before getting its dimensions
    image.onload = function () {
        canvas.width = image.width;
        canvas.height = image.height;
        context.drawImage(image, 0, 0, image.width, image.height);

        // Get pixel data
        var imageData = context.getImageData(0, 0, image.width, image.height);
        var pixelData = imageData.data;
        var width = imageData.width;
        var height = imageData.height;

        // Convert to 2D array
        var pixelArray = [];

        for (var y = 0; y < height; y++) {
            var row = [];
            for (var x = 0; x < width; x++) {
                var index = (y * width + x) * 4;
                // Assuming the image is grayscale, use the red channel value
                var pixelValue = pixelData[index];
                row.push(pixelValue);
            }
            pixelArray.push(row);
        }

        // Use the pixel array to create a 3D scene in Babylon.js
        createBabylonScene(pixelArray);
    };

    // Babylon.js scene creation function
    function createBabylonScene(pixelArray) {
        var canvas = document.getElementById('renderCanvas');
        var engine = new BABYLON.Engine(canvas, true);
        var scene = new BABYLON.Scene(engine);

        // Camera
        var camera = new BABYLON.ArcRotateCamera('camera', 0, 0, 10, BABYLON.Vector3.Zero(), scene);
        camera.attachControl(canvas, true);

        // Light
        var light = new BABYLON.HemisphericLight('light', BABYLON.Vector3.Up(), scene);

        // Create boxes based on the pixel values
        for (var y = 0; y < pixelArray.length; y++) {
            for (var x = 0; x < pixelArray[y].length; x++) {
                var pixelValue = pixelArray[y][x];
                // Create a box at (x, y, pixelValue)
                var box = BABYLON.MeshBuilder.CreateBox('box', { size: 1 }, scene);
                box.position = new BABYLON.Vector3(x, y, pixelValue);
            }
        }

        // Render loop
        engine.runRenderLoop(function () {
            scene.render();
        });

        // Handle window resize
        window.addEventListener('resize', function () {
            engine.resize();
        });
    }
</script>

</body>
</html>
