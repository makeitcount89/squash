<!DOCTYPE html>
<html>
<head>
    <title>Guitar Tuner</title>
</head>
<body>
    <h1>GTuner</h1>
    <p>This page will automatically request microphone access and start tuning when you grant permission.</p>

    <div id="tunerDisplay">Waiting for microphone access...</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.7/Tone.min.js"></script>
    <script>
        let tuner;
        let tunerDisplay = document.getElementById("tunerDisplay");

        function startTuner() {
            if (!tuner) {
                tuner = new Tone.FrequencyAnalyzer({
                    size: 2048, // Buffer size
                    type: "fft",
                });

                Tone.UserMedia.open()
                    .then((mic) => {
                        mic.connect(tuner);
                        tuner.toDestination();
                        tunerInput();
                    })
                    .catch((error) => {
                        console.error("Error accessing microphone:", error);
                    });
            }
        }

        function tunerInput() {
            if (tuner && tuner.isInitialized) {
                const note = tuner.getFrequency();
                if (note) {
                    const closestNote = Tone.Frequency(note).toNote();
                    tunerDisplay.textContent = `Detected Note: ${closestNote}`;
                }
                requestAnimationFrame(tunerInput);
            }
        }

        // Automatically start the tuner when the page loads
        startTuner();
    </script>
</body>
</html>
