<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Planner</title>
    <script defer src="https://cdn.babylonjs.com/babylon.js"></script>
    <style>
        html, body { height: 100%; margin: 0; overflow: hidden; }
        #mainCanvas { display: block; width: 80%; height: 100%; float: right; }
        #previewCanvas { display: block; width: 20%; height: 20%; position: absolute; top: 0; left: 0; z-index: 1; }
    </style>
</head>
<body>
    <canvas id="mainCanvas"></canvas>
    <canvas id="previewCanvas"></canvas>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Set up Babylon.js scene
            var mainCanvas = document.getElementById("mainCanvas");
            var previewCanvas = document.getElementById("previewCanvas");

            var engine = new BABYLON.Engine(mainCanvas, true);
            var scene = new BABYLON.Scene(engine);
            var camera = new BABYLON.ArcRotateCamera("camera", 0, 0, 10, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(mainCanvas, true);

            // Create 2D base (12m x 6m)
            var base = BABYLON.MeshBuilder.CreateBox("base", { width: 12, height: 6, depth: 0.1 }, scene);
            base.material = new BABYLON.StandardMaterial("baseMaterial", scene);
            base.material.wireframe = true;

            // Create 3D walls (20cm thick and 2m high)
            var walls = [
                BABYLON.MeshBuilder.CreateBox("topWall", { width: 12, height: 2, depth: 0.2 }, scene),
                BABYLON.MeshBuilder.CreateBox("bottomWall", { width: 12, height: 2, depth: 0.2 }, scene),
                BABYLON.MeshBuilder.CreateBox("leftWall", { width: 0.2, height: 6, depth: 2 }, scene),
                BABYLON.MeshBuilder.CreateBox("rightWall", { width: 0.2, height: 6, depth: 2 }, scene),
            ];

            // Position and adjust the walls
            walls[0].position.y = 3;
            walls[1].position.y = -3;
            walls[2].position.x = -6;
            walls[3].position.x = 6;

            walls.forEach(wall => {
                wall.material = new BABYLON.StandardMaterial("wallMaterial", scene);
                wall.material.wireframe = true;
            });

            // Set up camera position
            camera.setPosition(new BABYLON.Vector3(0, 0, 10));

            // Enable pinch zoom
            var pinchDistanceStart = 0;
            var pinchZoomSpeed = 0.1; // Adjust this value to control the zoom speed

            scene.onPointerObservable.add(function (pointerInfo) {
                switch (pointerInfo.type) {
                    case BABYLON.PointerEventTypes.POINTERDOWN:
                        if (pointerInfo.event.pointerType === "touch" && pointerInfo.pickInfo.pickedMesh === mainCanvas) {
                            pinchDistanceStart = BABYLON.Tools.GetPointerCoordinates(pointerInfo.event)[0].distanceTo(BABYLON.Tools.GetPointerCoordinates(pointerInfo.event)[1]);
                        }
                        break;
                    case BABYLON.PointerEventTypes.POINTERUP:
                        pinchDistanceStart = 0;
                        break;
                    case BABYLON.PointerEventTypes.POINTERMOVE:
                        if (pinchDistanceStart > 0 && pointerInfo.event.pointerType === "touch" && pointerInfo.pickInfo.pickedMesh === mainCanvas) {
                            var pinchDistance = BABYLON.Tools.GetPointerCoordinates(pointerInfo.event)[0].distanceTo(BABYLON.Tools.GetPointerCoordinates(pointerInfo.event)[1]);
                            var pinchDelta = pinchDistance - pinchDistanceStart;
                            camera.radius -= pinchDelta * pinchZoomSpeed;
                            pinchDistanceStart = pinchDistance;
                        }
                        break;
                }
            });

            // Render the scene
            engine.runRenderLoop(function () {
                scene.render();

                // Render the preview
                var previewEngine = new BABYLON.Engine(previewCanvas, false);
                var previewScene = new BABYLON.Scene(previewEngine);
                var previewCamera = new BABYLON.ArcRotateCamera("previewCamera", 0, 0, 10, BABYLON.Vector3.Zero(), previewScene);
                previewCamera.attachControl(previewCanvas, true);

                // Clone the main scene into the preview scene
                scene.meshes.forEach(mesh => {
                    var previewMesh = mesh.clone(mesh.name + "_preview", null, true);
                    previewMesh.material = new BABYLON.StandardMaterial("previewMaterial", previewScene);
                    previewMesh.material.wireframe = true;
                    previewScene.addMesh(previewMesh);
                });

                previewEngine.runRenderLoop(function () {
                    previewScene.render();
                });

                // Dispose of the resources when done rendering the preview
                previewEngine.dispose();
            });

            // Handle window resize
            window.addEventListener('resize', function () {
                engine.resize();
            });
        });
    </script>
</body>
</html>
