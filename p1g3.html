<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D to 3D Floor Plan</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babylonjs/5.6.3/babylon.max.js"></script>
</head>
<body>
    <input type="file" id="imageInput" accept="image/*" style="display: none;">
    <button onclick="uploadImage()">Upload Image</button>
    <button onclick="extractLines()">Extract Lines</button>
    <button onclick="render3D()">Render 3D</button>

    <label for="wallThickness">Wall Thickness:</label>
    <input type="number" id="wallThickness" value="0.1">

    <label for="wallHeight">Wall Height:</label>
    <input type="number" id="wallHeight" value="1">

    <canvas id="renderCanvas" width="800" height="600"></canvas>

    <script>
        var canvas = document.getElementById("renderCanvas");
        var engine = new BABYLON.Engine(canvas, true);
        var scene = new BABYLON.Scene(engine);
        var camera = new BABYLON.ArcRotateCamera("Camera", Math.PI / 2, Math.PI / 4, 4, BABYLON.Vector3.Zero(), scene);
        camera.attachControl(canvas, true);

        var lines;

        function uploadImage() {
            var input = document.getElementById("imageInput");
            input.click();

            input.onchange = function () {
                var file = input.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var img = new Image();
                        img.src = e.target.result;
                        img.onload = function () {
                            extractLinesFromImage(img);
                        };
                    };
                    reader.readAsDataURL(file);
                }
            };
        }

        function extractLines() {
            if (lines) {
                lines.forEach(line => line.dispose());
            }

            var wallThickness = parseFloat(document.getElementById("wallThickness").value);
            var wallHeight = parseFloat(document.getElementById("wallHeight").value);

            // Implement your line extraction logic here
            // This is a placeholder for illustration purposes
            // You may want to use more advanced techniques or libraries
            // For simplicity, we create a few random lines
            lines = createRandomLines(scene, wallThickness, wallHeight);
        }

        function render3D() {
            // Implement your 3D rendering logic here
            // This is a placeholder for illustration purposes
            // You may want to use the lines generated earlier to create walls
            console.log("Rendering 3D");
        }

        function extractLinesFromImage(image) {
            // Implement your image processing logic here
            // This is a placeholder for illustration purposes
            // You may want to use more advanced techniques or libraries
            // For simplicity, we create a few random lines
            lines = createRandomLines(scene, 0.1, 1);
        }

        function createRandomLines(scene, thickness, height) {
            var randomLines = [];

            // Creating a few random lines for illustration purposes
            for (var i = 0; i < 5; i++) {
                var x1 = Math.random() * 5;
                var y1 = Math.random() * 5;
                var x2 = Math.random() * 5;
                var y2 = Math.random() * 5;

                var points = [
                    new BABYLON.Vector3(x1, 0, y1),
                    new BABYLON.Vector3(x2, 0, y2)
                ];

                var line = BABYLON.MeshBuilder.CreateLines(null, { points: points, instance: null }, scene);
                line.color = new BABYLON.Color3(Math.random(), Math.random(), Math.random());
                line.isPickable = false;

                randomLines.push(line);
            }

            return randomLines;
        }

        engine.runRenderLoop(function () {
            scene.render();
        });

        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>
